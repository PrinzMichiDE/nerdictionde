generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Review {
  id          String   @id @default(cuid())
  title       String
  title_en    String?
  slug        String   @unique
  category    String   // "game" | "hardware" | "amazon" | "movie" | "series"
  content     String   // Markdown
  content_en  String?  // Markdown English
  score       Int      // 0-100
  pros        String[]
  pros_en     String[]
  cons        String[]
  cons_en     String[]
  images      String[] // Vercel Blob URLs
  youtubeVideos String[] // YouTube video IDs or URLs (e.g., "dQw4w9WgXcQ" or "https://youtube.com/watch?v=dQw4w9WgXcQ")
  status      String   @default("draft") // "draft" | "published"
  igdbId      Int?
  tmdbId      Int?     // TMDB ID for movies and series
  steamAppId  String?
  amazonAsin  String?  // Amazon Product ASIN
  affiliateLink String? // Amazon Affiliate Link
  hardwareId  String?  // Reference to Hardware model
  specs       Json?    // Hardware requirements or technical specs
  metadata    Json?    // Additional IGDB metadata (developer, publisher, modes, etc.)
  hardware    Hardware? @relation(fields: [hardwareId], references: [id], onDelete: SetNull)
  comments    Comment[]
  userRatings UserRating[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([category, status])
  @@index([amazonAsin])
  @@index([tmdbId])
}

model Comment {
  id        String   @id @default(cuid())
  text      String
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  reviewId  String
  author    String
  createdAt DateTime @default(now())

  @@index([reviewId])
}

model UserRating {
  id        String   @id @default(cuid())
  score     Int     // 0-10
  review    Review  @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  reviewId  String
  createdAt DateTime @default(now())

  @@unique([reviewId]) // Ein Rating pro Review (sp√§ter mit User-ID erweitern)
  @@index([reviewId])
}

model Hardware {
  id          String   @id @default(cuid())
  name        String
  name_en     String?
  slug        String   @unique
  type        String   // "gpu" | "cpu" | "motherboard" | "ram" | "storage" | "psu" | "case" | "cooler" | "monitor" | "keyboard" | "mouse" | "headset" | "controller" | "console"
  manufacturer String? // e.g. "NVIDIA", "AMD", "Intel", "Sony", "Microsoft"
  model       String? // e.g. "RTX 4090", "Ryzen 9 7950X", "PlayStation 5"
  specs       Json?    // Technical specifications (varies by type)
  images      String[] // Product images URLs
  description String?  // Short description
  description_en String?
  releaseDate DateTime?
  msrp        Float?   // Manufacturer's suggested retail price
  reviews     Review[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([type, manufacturer])
  @@index([name])
}

model PCBuild {
  id             String        @id @default(cuid())
  pricePoint     Int
  type           String        @default("desktop") // "desktop" | "laptop"
  title          String
  title_en       String?
  slug           String        @unique
  description    String?
  description_en String?
  image          String?
  image_en       String?
  totalPrice     Float
  currency       String        @default("EUR")
  status         String        @default("draft") // "draft" | "published"
  affiliateLink  String?
  lastScrapedAt  DateTime?
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  components     PCComponent[]

  @@unique([pricePoint, type])
  @@index([pricePoint])
  @@index([slug])
  @@index([status])
}

model PCComponent {
  id             String   @id @default(cuid())
  pcBuildId      String
  type           String   // "CPU" | "GPU" | "Motherboard" | "RAM" | "SSD" | "PSU" | "Case" | "Cooler" | etc.
  name           String
  manufacturer   String?
  model          String?
  image          String?
  description    String?
  description_en String?
  price          Float?
  currency       String    @default("EUR")
  affiliateLink  String?
  reviewId       String?
  specs          Json?
  sortOrder      Int       @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  pcBuild        PCBuild  @relation(fields: [pcBuildId], references: [id], onDelete: Cascade)

  @@index([pcBuildId])
  @@index([type])
}

model BulkJob {
  id                     String        @id @default(cuid())
  jobId                  String        @unique
  status                 String        // "pending" | "running" | "completed" | "failed"
  category               String        // "game" | "movie" | "series" | "hardware" | "product"
  total                  Int
  processed              Int           @default(0)
  successful             Int           @default(0)
  failed                 Int           @default(0)
  skipped                Int           @default(0)
  currentBatch           Int           @default(0)
  totalBatches           Int           @default(0)
  config                 Json?
  startTime              DateTime      @default(now())
  endTime                DateTime?
  estimatedTimeRemaining Int?
  errors                 Json?
  reviews                Json?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  queue                  BulkJobItem[]

  @@index([status])
  @@index([createdAt])
}

model BulkJobItem {
  id         String   @id @default(cuid())
  jobId      String
  job        BulkJob  @relation(fields: [jobId], references: [jobId], onDelete: Cascade)
  name       String
  igdbId     Int?
  tmdbId     Int?
  status     String   @default("pending") // "pending" | "processing" | "completed" | "failed" | "skipped"
  error      String?
  reviewId   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([jobId])
  @@index([status])
}
